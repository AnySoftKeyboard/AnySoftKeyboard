{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": ["config:recommended"],
  "platform": "github",
  "onboarding": false,
  "requireConfig": "optional",
  "gitAuthor": "Polyglot <ask@evendanan.net>",
  "bazel": {
    "enabled": true
  },
  "packageRules": [
    {
      "description": "Group development tooling updates together (Bazel, Node.js, pnpm)",
      "matchManagers": ["bazel", "bazel-module", "nvm", "npm"],
      "matchDepTypes": ["packageManager"],
      "matchFiles": [".bazelversion", ".nvmrc", "package.json"],
      "groupName": "Development tooling"
    },
    {
      "description": "Group all app-affecting dependencies together (AndroidX, Google Android, Kotlin, etc.) to ensure atomic updates",
      "matchManagers": ["gradle"],
      "excludePackagePatterns": ["^gradle$"],
      "groupName": "Android app dependencies"
    },
    {
      "description": "Gradle wrapper updates separately",
      "matchManagers": ["gradle-wrapper"],
      "groupName": "Gradle wrapper"
    },
    {
      "description": "Group GitHub Actions updates together",
      "matchManagers": ["github-actions"],
      "groupName": "GitHub Actions"
    },
    {
      "description": "Run spotlessApply after spotless plugin update to reformat code with new version",
      "matchPackageNames": ["com.diffplug.spotless"],
      "postUpgradeTasks": {
        "commands": ["./gradlew spotlessApply"],
        "fileFilters": ["**/*.java", "**/*.kt", "**/*.gradle", "**/*.md"],
        "executionMode": "branch"
      }
    },
    {
      "description": "Run error-prone auto-patch after error-prone updates to fix new warnings",
      "matchPackageNames": ["net.ltgt.errorprone", "com.google.errorprone:error_prone_core"],
      "postUpgradeTasks": {
        "commands": ["scripts/error-prone-auto-patch.sh"],
        "fileFilters": ["**/*.java"],
        "executionMode": "branch"
      }
    },
    {
      "description": "Group JavaScript dependencies and update Bazel MODULE lockfile",
      "matchManagers": ["npm"],
      "groupName": "JavaScript dependencies",
      "postUpgradeTasks": {
        "commands": ["bazel build //..."],
        "fileFilters": ["MODULE.bazel.lock", "pnpm-lock.yaml"],
        "executionMode": "branch"
      }
    },
    {
      "description": "Update robolectric_jars_versions.txt when Robolectric version changes",
      "matchPackageNames": ["org.robolectric:robolectric"],
      "postUpgradeTasks": {
        "commands": ["scripts/update_robolectric_jars_versions.sh {{{newVersion}}}"],
        "fileFilters": ["scripts/robolectric_jars_versions.txt"],
        "executionMode": "branch"
      }
    }
  ]
}
