name: "deploy"
description: "Deploys the AnySoftKeyboard artifacts to Play Store"
author: "menny"

inputs:
  deploy_tasks:
    description: "gradle tasks to execute"
    required: true
  ref:
    description: "the commit to calculate the version from"
    default: "HEAD"
    required: false
  crash_report_email:
    default: "none@example.com"
    required: false
  keystore_url:
    default: ""
    required: false
  keystore_password:
    default: ""
    required: false
  keystore_key_alias:
    default: ""
    required: false
  keystore_key_password:
    default: ""
    required: false
  publish_service_account_creds_url:
    default: ""
    required: false
  publish_service_account:
    default: ""
    required: false
  deploy_approval_filename:
    default: ""
    required: false
runs:
  using: "docker"
  image: "docker://menny/ndk_ask:1.13.1"
  env:
    TERM: dumb
    GRADLE_OPTS: "-Dorg.gradle.daemon=false --stacktrace"
    GRADLE_USER_HOME: ".github_cache_gradle/"

  entrypoint: /bin/bash
  args:
    - .github/actions/deploy/deploy.sh
    - ${{ inputs.deploy_approval_filename }}
    - ${{ inputs.ref }}
    - ${{ inputs.crash_report_email }}
    - ${{ inputs.keystore_url }}
    - ${{ inputs.keystore_password }}
    - ${{ inputs.keystore_key_alias }}
    - ${{ inputs.keystore_key_password }}
    - ${{ inputs.publish_service_account_creds_url }}
    - ${{ inputs.publish_service_account }}
    - ${{ inputs.deploy_tasks }}

branding:
  icon: 'upload-cloud'
  color: 'blue'
