language: java
jdk:
  - oraclejdk8

env:
  global:
  # Signing settings
  - secure: HnEE9wLpveIRwFHI2/9TcMV3KQRWO8m2keVcuiPSFhmIUt0xpr4a58iMOU6lm1g/FhQWChZwut9ZqidiEGbJFxaVH2DvW0IvpiisQxUMw+St0pGArooz+sWJGFfC/Sv4mW3V/+Psh5t+ezFcy1KfGi3Qx9Aojms/5zEoIZJZMj5V61JUdlWf+nn+yHA/LwBHtKSSgdVxpfZsiYlJQe+Z2E3UwugSYnordv3K8xJ1oDqD4FtiW8fC+4RsNQ/osMQbhK6/Y30nX3xS6qM3coSKevOpV/Wqx18e/UhB1dmF7Ge3hOBHkxnIlRvSMF651XOKQnfptb27KYuBUg2PdpRgYg==
  - secure: Nc1rTXSOtaK5YICjMij1fahwxCwSmjpPHV9QaN9QEz+Gd7CfVe6mkJCsydAw5gL3aYyB+i7A4Nf3U8zZzMR5/V/VDIq1hdMHCrcKwFO/bJWWlyQxuIl/rAQZXXDfxbdaJlcsFsS/NZTcRzqLtNyaQWcmOzO2WMiLy90OwtqSubCKBVru+me9++0T4BsiIBg3072qE/iSlRZtNrtEqAO1KBdQIVuIIjumt6sDb8dNjAkAS+90rLgD6Il7QxC3/R7bhcULp5GuCqI/4nlk+SYNaD6xkmlG7mWhe9VD4tuYffc3aNYMfn72QS/Uw9XiNzXQzyccSoxAlGQaFWlLTa7pkA==
  - secure: DotN/r6QHqUf4X5w1l64jHHdTsPUwvirqhskDyD/bQAiGyxHVXACwEXVmMkcAXwRdtKrMC5YyxqbWKmw8jXvoY/ITOTXnVR/yMndBoOJ67sWhmEWOcqkPtY0cPZ/GeqNVHiOViilP3UwT93At/oBy0+PdlEHP4tI0+RI5qIzdTdpWcdor+DtWF/BSBMkxRAugWNv0sjf0vNjqvk08ZbCnJnHvJx2OQoqdn7hnY7acVvhDC4U1HtHxhp+4UV9caQI5bLlvU2CJm0E2IgKPeRLQMUWbwFvn3zdgiD4qgfl+zY1NAqq+3ep43jzhNgHIkh1zn048xnhkliKdHE4dZpDfw==
  - secure: EPzlU+L+oqhzQobnEZWatm6IucSDaDOhS9JmOjpviYlV9zzvDdi/ZR99DJ8zul95MNi2BP7KnqgwPqdazGQS5wy/fSTMMdtacUMQbiY7plhGsZFYuogeqGkVYM6L/Qt5O8LUovRGX5OPHV6J9qZuqpAqeWcFc2jNySXEA4gEQKVi6z/Q+ks1tpIyB+8sc5ixgF5mi5pR2veYTgOlpmtSSMmOOcH1Zc9uaeRuJsqnMGlKn6P8IE5q00Hlf6Mx+8kzXA1sQIdAlr101US1rRifVeNHBX5KZZqWh7RLZBraTV3LACK2kz/+nnA8x5y9XsIN8ZCFOBpUpP3s0SfMom/oqg==
  # crash report email
  - secure: QnmvDbt4YbmAC89hqL+PoWT1DT5yoe9E0QhQKO+UoWk3Nj7HOpcQpYmwnbJYtL22GTHkM1VGuCCgmeZbhRr5R7cgKd1dTqwJHBG1yopXab6sV27guIRd5LIvZyinCWXqof70ACzVLYoWtcHKfsAt7ys4nkTwbMbDfakyhf2sVEao29dVlC/tIOrr1iWdrXLX+lIKFITahqvZzOjBzzTigeKdUdn5bWVeNk6fy7MQwDxTxhZZboIO86QRplMo8ysCMR9lulCsfeRfS4lOYO2KC5eKXDi1GiwzJlZwmEmBZ2jkfwBVSqwXpMQk8g8uEymmpd4Wdfj786JiJh3CCRbphw==
  # publish cert
  - secure: OhtlIx80ViK4rQ20xCyOV11MWgYKjghTy25vy7RNP5CwsXafF3ID8bQxc7k444EqEDVD07BBjO93ubqtePfG0+1OXbKZAGYRkKBqvCI/g/SXxcpxYZgbr9jgQ8Il3Ome0XsHQQuTmX71a4d2HpBdKJhBrFZRzFC8bYsT8oKx7RNq7Mz6ryVwi5ItH+yoFoiaDv6U3wDtjaRZUAX76NSIfO+Vvj8X1C/TNMp9PxX5qY9zw//GgFP+vlzftWUazoh4zd9wCalGP8lpvzIWxZxaaJAW8luwixTy56VlsVLvvvSeIrp0Vw+AACTA3EVo3U+PjurJn46JLPP8qarkXVvpOw==
  - secure: MAADpIIVqZ15yGnmvAVunsYKpkNwsFPVRS/2tYweehOBoHwHsTlXCGA3JNtNghalxNqWbGjUC4wHgheK0Pl82aoPIJv8pN83cU4BfPehFH6wKwciEiFatlRoco19ayOFkb1CqV8GHPclyhv3BGuMSlckusBbEfHbBSUydi1pvmVCB+PlOeMR6E2I7AOhxRBrBCKZ/Yvc2CrrFAGTr1fHeNNiCrqV0qTNBOeQp62i7CYzjvqzOZxjeO8+nTA17tR9eXwqGB6I0rd44Xc7GYtpLJvSqa3JevPMwah8pRIpf/wGaap4h/mTz6h2BZ8C1vzFMQYZ4mfbhq8k4NwzNmtsAA==
  - CODECOV_TOKEN="1a4cd171-2784-4f48-8a62-0b7ec31e6d7e"
  - COV_REPORT_LOCATION="app/build/reports/jacoco/testDebugUnitTestCoverage/testDebugUnitTestCoverage.xml"

build:
  pre_ci_boot:
    image_name: menny/android_ndk
    image_tag: 1.5.1
    pull: true
  ci:
    - mkdir -p shippable/testresults
    - mkdir -p shippable/codecoverage
    - ./gradlew clean
    - ./gradlew checkDebug
    - ./gradlew testDebugUnitTest :app:testDebugUnitTestCoverage
    #copying reports for Shippable
    - cp -r app/build/test-results/* shippable/testresults/
    #converting JaCoCo to cobertura
    - wget -O cover2cover.py https://raw.githubusercontent.com/rix0rrr/cover2cover/master/cover2cover.py
    - python cover2cover.py $COV_REPORT_LOCATION app/src/main/java > shippable/codecoverage/coverage.xml
    # posts code-coverage to codecov.io
    - wget -O codecov.sh https://codecov.io/bash
    - chmod +x codecov.sh
    - ./codecov.sh -X gcov -X coveragepy -f $COV_REPORT_LOCATION
    #ci_deploy_script.sh will also ensure that we are in the `master` branch and that we have secure env setup.
    - ./scripts/ci_deploy_script.sh $BRANCH $KEYSTORE_FILE_URL $PUBLISH_CERT_FILE_URL
integrations:
    notifications:
        - integrationName: email
          type: email
          recipients:
            - mennyed@gmail.com
          on_success: always
          on_failure: always
